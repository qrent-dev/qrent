<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>qrent - 租房助手</title>
    <style>
        :root {
            /* 主题色系统 */
            --primary-color: #1E4F9C;
            --primary-light: #4C7FD4;
            --primary-dark: #163C7A;
            --primary-bg: #F5F8FF;
            
            /* 中性色系统 */
            --background-light: #FFFFFF;
            --background-dark: #F8F9FA;
            --background-hover: #F5F8FF;
            --border-color: #E8EDF6;
            --divider-color: #E1E7F3;
            
            /* 文字颜色 */
            --text-primary: #1A2B4D;
            --text-secondary: #4A5B7C;
            --text-tertiary: #8896B4;
            --text-light: #FFFFFF;
            
            /* 功能色 */
            --success: #2E7D32;
            --warning: #ED6C02;
            --error: #D32F2F;
            --info: #0288D1;
            
            /* 阴影系统 */
            --shadow-sm: 0 2px 4px rgba(30, 79, 156, 0.06);
            --shadow-md: 0 4px 8px rgba(30, 79, 156, 0.08);
            --shadow-lg: 0 8px 16px rgba(30, 79, 156, 0.12);
            --shadow-hover: 0 12px 24px rgba(30, 79, 156, 0.16);
            
            /* 圆角系统 */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-full: 9999px;
            
            /* 间距系统 */
            --spacing-xs: 0.25rem;  /* 4px */
            --spacing-sm: 0.5rem;   /* 8px */
            --spacing-md: 1rem;     /* 16px */
            --spacing-lg: 1.5rem;   /* 24px */
            --spacing-xl: 2rem;     /* 32px */
            --spacing-2xl: 3rem;    /* 48px */
            
            /* 过渡动画 */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
            
            /* 字体系统 */
            --font-family: 'Roboto', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --font-size-xs: 0.75rem;   /* 12px */
            --font-size-sm: 0.875rem;  /* 14px */
            --font-size-md: 1rem;      /* 16px */
            --font-size-lg: 1.125rem;  /* 18px */
            --font-size-xl: 1.25rem;   /* 20px */
            --font-size-2xl: 1.5rem;   /* 24px */
            
            /* 字重系统 */
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            /* 行高系统 */
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;
            
            /* 栅格系统 */
            --container-max-width: 1800px;
            --grid-gap: 2.5rem;
            --column-gap: 2rem;
        }

        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            line-height: var(--line-height-normal);
            background: var(--background-light);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 导航栏样式 */
        .navbar {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg) var(--spacing-2xl);
            background: var(--background-light);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            z-index: 1000;
        }

        .logo {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: var(--transition-normal);
        }

        .logo:hover {
            color: var(--primary-dark);
            transform: translateY(-1px);
        }

        .nav-links {
            display: flex;
            gap: var(--spacing-xl);
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-md);
            transition: var(--transition-normal);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: var(--transition-normal);
            transform: translateX(-50%);
        }

        .nav-links a:hover {
            color: var(--primary-color);
            background: var(--primary-bg);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        /* 主要内容区域 */
        .main-content {
            padding: var(--spacing-lg);
            max-width: var(--container-max-width);
            margin-left: auto;
            margin-right: auto;
        }

        /* 租房流程部分 */
        .process-section {
            max-width: var(--container-max-width);
            margin: 0 auto;
            padding: var(--spacing-2xl) var(--spacing-xl);
        }

        .process-section h2 {
            color: var(--text-primary);
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--primary-color);
            display: inline-block;
        }

        .process-cards {
            display: flex;
            flex-wrap: nowrap;
            gap: var(--spacing-xl);
            margin-top: var(--spacing-xl);
            padding: var(--spacing-md) 0;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .process-cards::-webkit-scrollbar {
            display: none;
        }

        .process-card {
            background: var(--background-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            min-width: 280px;
            flex: 1;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: var(--transition-normal);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: visible;  /* 修改为 visible 以显示溢出的徽章 */
            text-decoration: none;
        }

        .process-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary-light);
        }

        .process-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--primary-light));
            transform: scaleX(0);
            transition: var(--transition-normal);
            transform-origin: left;
        }

        .process-card:hover::before {
            transform: scaleX(1);
        }

        .process-card h3 {
            font-size: var(--font-size-lg);
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
            font-weight: var(--font-weight-semibold);
        }

        .process-card p {
            color: var(--text-secondary);
            font-size: var(--font-size-md);
            line-height: var(--line-height-relaxed);
        }

        /* AI助手部分优化 */
        .ai-section {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: var(--spacing-xl);
            padding: var(--spacing-xl);
            background: var(--background-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        /* 统一三个主要区块的基础样式 */
        .sidebar, .chat-window, .recommendations {
            min-height: 950px;
            background: var(--background-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            padding: var(--spacing-xl);
            display: flex;
            flex-direction: column;
            transition: var(--transition-normal);
        }

        .sidebar:hover, .chat-window:hover, .recommendations:hover {
            box-shadow: var(--shadow-lg);
        }

        /* 聊天窗口样式优化 */
        .chat-window {
            background: var(--background-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        .chat-messages {
            flex-grow: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
            max-height: 600px;
            background: var(--background-dark);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .message {
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-lg);
            max-width: 85%;
            margin-bottom: var(--spacing-md);
            animation: messageSlide 0.3s ease;
            line-height: var(--line-height-relaxed);
            font-size: var(--font-size-md);
            box-shadow: var(--shadow-sm);
        }

        .message.user {
            background: var(--primary-color);
            color: var(--text-light);
            align-self: flex-end;
            margin-left: 15%;
            border-bottom-right-radius: var(--radius-sm);
        }

        .message.ai {
            background: white;
            color: var(--text-primary);
            align-self: flex-start;
            margin-right: 15%;
            border-bottom-left-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .message.system {
            background: var(--background-light);
            color: var(--text-secondary);
            align-self: center;
            text-align: center;
            max-width: 90%;
            font-size: var(--font-size-sm);
            border: 1px solid var(--border-color);
        }

        .quick-questions {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--background-light);
            border-radius: var(--radius-md);
        }

        .quick-question-btn {
            padding: var(--spacing-md);
            background: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            text-align: left;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            transition: var(--transition-normal);
        }

        .quick-question-btn:hover {
            background: var(--background-hover);
            border-color: var(--primary-color);
            transform: translateX(var(--spacing-xs));
        }

        .chat-input-container {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--background-light);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .chat-input {
            flex-grow: 1;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-md);
            background: var(--background-light);
            transition: var(--transition-normal);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 79, 156, 0.1);
        }

        .chat-send-button {
            padding: var(--spacing-md) var(--spacing-xl);
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-normal);
            font-weight: var(--font-weight-medium);
        }

        .chat-send-button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .chat-send-button:active {
            transform: translateY(0);
        }

        /* 消息动画 */
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 标题统一样式优化 */
        .sidebar h3, .chat-window h3, .recommendations h3 {
            font-size: var(--font-size-xl);
            color: var(--text-primary);
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-color);
            font-weight: var(--font-weight-semibold);
        }

        /* 导航卡片样式优化 */
        .guide-section {
            margin-bottom: var(--spacing-xl);
        }

        .guide-section-title {
            color: var(--primary-color);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin: var(--spacing-lg) 0 var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--background-dark);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--primary-color);
        }

        .guide-card {
            background: transparent;
            padding: var(--spacing-md) var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
            border-radius: var(--radius-md);
            position: relative;
            transition: var(--transition-normal);
        }

        .guide-card a {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-primary);
            padding: var(--spacing-md) var(--spacing-lg);
            font-size: var(--font-size-md);
        }

        .guide-card:hover {
            background: var(--background-hover);
            transform: translateX(var(--spacing-sm));
        }

        /* 工具按钮统一样式 */
        .tool-button {
            width: 100%;
            padding: 0.8rem 1rem;
            margin-bottom: 0.8rem;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            text-align: left;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .tool-button:hover {
            background: var(--hover-bg);
            transform: translateX(5px);
            border-left: 3px solid var(--primary-color);
        }

        /* 输入组统一样式 */
        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .input-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30, 136, 229, 0.1);
        }

        /* 计算器结果样式 */
        #simpleResult {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--background-light);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            line-height: 1.6;
            border: 1px solid var(--border-color);
        }

        #simpleResult h4 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        #simpleResult p {
            margin-bottom: 0.5rem;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .ai-section {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }
        }

        /* 页脚样式优化 */
        .footer {
            background: #f8f9fa;
            color: var(--text-secondary);
            padding: var(--spacing-md) 0;
            margin-top: var(--spacing-xl);
            border-top: 1px solid var(--border-color);
        }

        .footer-content {
            max-width: var(--container-max-width);
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-lg);
            padding: 0 var(--spacing-xl);
        }

        .footer-section {
            padding: var(--spacing-xs);
            transition: var(--transition-normal);
        }

        .footer-section:hover {
            transform: translateY(-3px);
        }

        .footer h3 {
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .footer p {
            color: var(--text-secondary);
            font-size: var(--font-size-xs);
            line-height: var(--line-height-normal);
            margin-bottom: var(--spacing-xs);
        }

        .footer .guide-links {
            list-style: none;
            padding: 0;
        }

        .footer .guide-links li {
            margin-bottom: var(--spacing-xs);
        }

        .footer a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition-normal);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-xs);
        }

        .footer a:hover {
            color: var(--primary-color);
            transform: translateX(var(--spacing-xs));
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) 0;
            transition: var(--transition-normal);
        }

        .social-link:hover {
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
                padding: 0 var(--spacing-md);
            }
            
            .footer {
                padding: var(--spacing-md);
            }
        }

        /* 工具区域样式优化 */
        .tool-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        #toolList {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .tool-button {
            width: 100%;
            padding: var(--spacing-lg);
            background: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            text-align: left;
            font-size: var(--font-size-md);
            color: var(--text-primary);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .tool-button::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--primary-color);
            transform: scaleY(0);
            transition: transform 0.2s ease;
        }

        .tool-button:hover {
            background: var(--background-hover);
            transform: translateX(var(--spacing-sm));
        }

        .tool-button:hover::before {
            transform: scaleY(1);
        }

        /* 预算计算器样式优化 */
        #calculatorContent {
            flex: 1;
            overflow-y: auto;
            padding-right: var(--spacing-md);
        }

        #calculatorContent h4 {
            color: var(--text-primary);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-lg);
        }

        .input-group {
            margin-bottom: var(--spacing-lg);
        }

        .input-group label {
            display: block;
            margin-bottom: var(--spacing-sm);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .input-group input {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-md);
            transition: var(--transition-normal);
            background: var(--background-light);
            color: var(--text-primary);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 79, 156, 0.1);
        }

        .input-group input:hover {
            border-color: var(--primary-light);
        }

        #simpleResult {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--background-dark);
            border-radius: var(--radius-md);
            font-size: var(--font-size-md);
            line-height: var(--line-height-relaxed);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease;
        }

        #simpleResult h4 {
            color: var(--primary-color);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--border-color);
        }

        #simpleResult p {
            margin-bottom: var(--spacing-sm);
            color: var(--text-secondary);
        }

        #simpleResult p strong {
            color: var(--text-primary);
            font-weight: var(--font-weight-medium);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 响应式设计优化 */
        @media (max-width: 1200px) {
            .ai-section {
                grid-template-columns: 1fr 1fr;
                gap: var(--spacing-xl);
            }
            
            .recommendations {
                grid-column: span 2;
            }
        }

        @media (max-width: 768px) {
            .ai-section {
                grid-template-columns: 1fr;
            }
            
            .recommendations {
                grid-column: span 1;
            }
            
            .nav-links {
                display: none;
            }
            
            .process-cards {
                flex-direction: column;
            }
            
            .process-card {
                width: 100%;
                margin-bottom: var(--spacing-md);
            }
        }

        /* 工具栏样式 */
        .tools-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .tool-item {
            background: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .tool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--background-dark);
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .tool-header:hover {
            background: var(--background-hover);
        }

        .tool-header h4 {
            margin: 0;
            color: var(--text-primary);
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
        }

        .toggle-icon {
            color: var(--text-secondary);
            transition: var(--transition-normal);
        }

        .tool-content {
            display: none;
            padding: var(--spacing-lg);
            background: var(--background-light);
        }

        .tool-content.active {
            display: block;
        }

        /* 导航链接样式 */
        .guide-links {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .guide-card {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-sm);
            transition: var(--transition-normal);
        }

        .guide-card:hover {
            background: var(--background-hover);
            transform: translateX(var(--spacing-xs));
        }

        .guide-card a {
            text-decoration: none;
            color: var(--text-primary);
        }

        .guide-card h4 {
            margin: 0;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        /* 预算计算器样式 */
        .input-group {
            margin-bottom: var(--spacing-md);
        }

        .input-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .input-group input {
            width: 100%;
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-md);
        }

        #simpleResult {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            background: var(--background-dark);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
        }

        /* 区域选择工具样式 */
        .area-selector {
            padding: var(--spacing-md);
        }

        .preferences-section {
            margin-bottom: var(--spacing-lg);
        }

        .slider-group {
            margin-bottom: var(--spacing-sm);
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--background-light);
            border-radius: var(--radius-sm);
        }

        .slider-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
        }

        .preference-slider {
            width: 100%;
            height: 4px;
            background: var(--background-dark);
            border-radius: var(--radius-full);
            outline: none;
            -webkit-appearance: none;
            margin: var(--spacing-xs) 0;
        }

        .preference-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .preference-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            background: var(--primary-light);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-top: var(--spacing-xs);
        }

        .results-section {
            background: var(--background-dark);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
        }

        .results-section h3 {
            font-size: var(--font-size-md);
            margin-bottom: var(--spacing-sm);
        }

        .area-results {
            margin-top: var(--spacing-sm);
        }

        .area-result-item {
            background: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition-normal);
        }

        .area-result-item:hover {
            transform: translateX(var(--spacing-xs));
            border-color: var(--primary-light);
            box-shadow: var(--shadow-md);
        }

        .area-result-rank {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--primary-color);
            margin-right: var(--spacing-md);
        }

        .area-result-info {
            flex-grow: 1;
        }

        .area-result-name {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .area-result-score {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .area-result-score-bar {
            flex-grow: 1;
            height: 4px;
            background: var(--background-dark);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .area-result-score-fill {
            height: 100%;
            background: var(--primary-color);
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
        }

        .area-result-score-value {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            min-width: 45px;
            text-align: right;
        }

        .area-result-details {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-xs);
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }
        .area-result-details span {
            background: var(--background-dark);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
        }
        .slider-value {
            position: absolute;
            right: var(--spacing-sm);
            top: var(--spacing-xs);
            background: var(--primary-color);
            color: white;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
        }
        .slider-group {
            position: relative;
        }

        /* 高效筛房卡片特殊样式 */
        .process-card.featured {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border: none;
            transform: scale(1.05);
        }

        .process-card.featured h3,
        .process-card.featured p {
            color: white;
        }

        .process-card.featured::after {
            content: '推荐';
            position: absolute;
            top: 10px;
            right: -30px;
            background: var(--secondary-color);
            color: white;
            padding: 2px 30px;
            transform: rotate(45deg);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
            box-shadow: var(--shadow-sm);
        }

        .process-card.featured:hover {
            transform: scale(1.08);
            box-shadow: var(--shadow-lg);
        }

        /* 建议添加的移动端优化样式 */
        @media (max-width: 768px) {
            .process-cards {
                flex-direction: column;
                padding: var(--spacing-sm);
            }
            
            .chat-window {
                height: calc(100vh - 200px);
            }
            
            .nav-links {
                position: fixed;
                bottom: 0;
                width: 100%;
                background: var(--background-light);
                padding: var(--spacing-sm);
                justify-content: space-around;
            }
        }

        .visit-stats {
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-sm);
            border-top: 1px solid var(--border-color);
        }
        
        .stats-container {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: var(--spacing-md);
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .stat-divider {
            width: 1px;
            height: 16px;
            background-color: var(--border-color);
        }
        
        .stat-icon {
            font-size: var(--font-size-sm);
            opacity: 0.8;
        }
        
        .stat-label {
            color: var(--text-tertiary);
        }
        
        .stat-value {
            font-weight: var(--font-weight-medium);
            color: var(--text-secondary);
        }

        /* 在 style 标签内添加或修改登录按钮相关样式 */
        .login-circle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            background: var(--background-light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .login-circle:hover {
            background: var(--primary-bg);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .login-text {
            color: var(--primary-color);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        /* 登录后的样式 */
        .login-circle.logged-in {
            background: var(--primary-color);
        }

        .login-circle.logged-in .login-text {
            color: var(--text-light);
        }

        /* 在现有样式后添加 */
        .user-menu-container {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 150px;
            margin-top: 8px;
            z-index: 1000;
        }

        .menu-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .menu-item:hover {
            background-color: #f5f5f5;
        }

        .username-item {
            border-bottom: 1px solid #eee;
            color: #666;
            font-weight: 500;
        }

        .logout-item {
            color: #ff4d4f;
        }

        .logout-item:hover {
            background-color: #fff1f0;
        }

        .dropdown-menu::before {
            content: '';
            position: absolute;
            top: -6px;
            right: 20px;
            width: 12px;
            height: 12px;
            background: white;
            transform: rotate(45deg);
            box-shadow: -2px -2px 5px rgba(0,0,0,0.04);
        }

        .username-item.disabled {
            cursor: default !important;
            color: #666 !important;
            background-color: transparent !important;
        }
        
        .username-item.disabled:hover {
            background-color: transparent !important;
        }

        /* 优化导航栏样式 */
        .nav-container {
            padding: 15px 0;
        }

        nav ul {
            display: flex;
            align-items: center;
            height: 60px;
        }

        nav ul li {
            display: flex;
            align-items: center;
            height: 100%;
            margin: 0 15px;
        }

        nav ul li a {
            padding: 8px 15px;
            font-size: 18px;
            line-height: 24px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 4px;
            display: flex;
            align-items: center;
        }

        nav ul li a:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* 登录按钮样式 */
        .login-circle {
            padding: 6px 16px;
            border: 1px solid var(--primary-color);
            border-radius: 20px;
            background: var(--background-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-circle:hover {
            background: var(--primary-bg);
        }

        .login-text {
            color: var(--primary-color);
            font-size: 14px;
            font-weight: 500;
        }

        /* 登录后的样式 */
        .login-circle.logged-in {
            background: var(--primary-color);
        }

        .login-circle.logged-in .login-text {
            color: var(--text-light);
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            /* 导航栏适配 */
            .navbar {
                padding: var(--spacing-md) var(--spacing-lg);
            }

            .nav-links {
                gap: var(--spacing-md);
            }

            /* 主内容区域适配 */
            .main-content {
                padding: var(--spacing-md);
                margin-top: 60px;
            }

            /* 租房流程卡片适配 */
            .process-section {
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .process-card {
                min-width: 280px;
                padding: var(--spacing-md);
            }

            /* 功能卡片适配 */
            .features-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
                padding: var(--spacing-md);
            }

            .feature-card {
                padding: var(--spacing-md);
            }

            /* 页脚适配 */
            .footer-content {
                flex-direction: column;
                padding: var(--spacing-lg) var(--spacing-md);
                gap: var(--spacing-xl);
            }

            .footer-section {
                width: 100%;
            }

            /* 统计数据适配 */
            .stats-container {
                flex-direction: column;
                gap: var(--spacing-md);
            }

            .stat-divider {
                display: none;
            }

            /* 浮动按钮适配 */
            .floating-buttons {
                bottom: var(--spacing-md);
                right: var(--spacing-md);
            }

            .floating-button {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            /* 导航菜单适配 */
            .nav-links {
                position: fixed;
                top: 60px;
                left: 0;
                width: 100%;
                background: var(--background-light);
                flex-direction: column;
                padding: var(--spacing-md);
                box-shadow: var(--shadow-md);
                transform: translateY(-100%);
                transition: transform var(--transition-normal);
                z-index: 999;
            }

            .nav-links.active {
                transform: translateY(0);
            }

            /* 汉堡菜单按钮 */
            .menu-toggle {
                display: block;
                background: none;
                border: none;
                padding: var(--spacing-sm);
                cursor: pointer;
            }

            .menu-toggle .bar {
                display: block;
                width: 24px;
                height: 2px;
                margin: 5px 0;
                background: var(--text-primary);
                transition: var(--transition-normal);
            }

            .menu-toggle.active .bar:nth-child(1) {
                transform: rotate(45deg) translate(5px, 5px);
            }

            .menu-toggle.active .bar:nth-child(2) {
                opacity: 0;
            }

            .menu-toggle.active .bar:nth-child(3) {
                transform: rotate(-45deg) translate(7px, -7px);
            }
        }

        @media (max-width: 768px) {
            /* 已有的移动端样式... */

            /* 增强移动端视觉效果 */
            .process-cards {
                display: flex;
                flex-direction: column;
                gap: var(--spacing-md);
            }

            .process-card {
                width: 100%;
                margin: 0;
                transform: none !important;  /* 取消卡片的3D效果 */
            }

            .process-card.featured {
                transform: none !important;
            }

            .process-card.featured::after {
                right: 0;
                transform: none;
                width: auto;
                left: 0;
                text-align: center;
            }

            /* AI助手部分适配 */
            .ai-section {
                grid-template-columns: 1fr;
            }

            .chat-window {
                height: 500px;  /* 固定高度，避免页面过长 */
            }

            /* 工具栏适配 */
            .tools-container {
                display: flex;
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .tool-item {
                margin: 0;
            }

            /* 页面标题适配 */
            .page-header {
                text-align: center;
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .page-title {
                font-size: 1.5rem;
            }

            /* 统计数据适配 */
            .visit-stats {
                text-align: center;
            }

            .stats-container {
                justify-content: center;
            }
        }

        /* 移动端样式优化 */
        @media (max-width: 768px) {
            /* 导航栏优化 */
            .navbar {
                padding: 10px 15px;
                height: 60px;
                position: fixed;
                width: 100%;
                top: 0;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                z-index: 1000;
            }

            .logo {
                font-size: 24px;
                font-weight: 600;
            }

            /* 主内容区域优化 */
            .main-content {
                margin-top: 70px;
                padding: 15px;
            }

            /* 租房流程部分优化 */
            .process-section {
                padding: 20px 0;
            }

            .process-section h2 {
                font-size: 20px;
                margin-bottom: 15px;
                padding: 0 15px;
            }

            .process-cards {
                padding: 0 15px;
                gap: 12px;
            }

            .process-card {
                min-width: unset;
                width: 100%;
                padding: 15px;
                margin: 0;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            }

            .process-card h3 {
                font-size: 16px;
                margin-bottom: 8px;
            }

            .process-card p {
                font-size: 14px;
                margin: 0;
                color: #666;
            }

            .process-card.featured {
                background: linear-gradient(135deg, #42A5F5, #1E88E5);
                transform: none !important;
            }

            .process-card.featured::after {
                display: none;
            }

            /* 工具栏优化 */
            .tool-item {
                margin-bottom: 12px;
                border-radius: 12px;
            }

            .tool-header {
                padding: 12px 15px;
            }

            .tool-header h4 {
                font-size: 15px;
            }

            /* AI助手部分优化 */
            .ai-section {
                padding: 15px;
                gap: 15px;
            }

            .chat-window {
                height: 400px;
                margin-bottom: 15px;
            }

            .chat-messages {
                padding: 10px;
            }

            .message {
                padding: 10px 12px;
                font-size: 14px;
                max-width: 90%;
            }

            /* 页脚优化 */
            .footer {
                padding: 20px 0;
                margin-top: 30px;
            }

            .footer-content {
                padding: 0 15px;
                gap: 20px;
            }

            .footer-section h3 {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .footer-section p {
                font-size: 13px;
            }

            /* 统计数据优化 */
            .visit-stats {
                margin-top: 15px;
                padding-top: 10px;
            }

            .stats-container {
                padding: 10px;
                background: #f8f9fa;
                border-radius: 8px;
            }

            .stat-item {
                font-size: 13px;
            }

            /* 登录按钮优化 */
            .login-circle {
                padding: 6px 12px;
                border-radius: 16px;
            }

            .login-text {
                font-size: 13px;
            }

            /* 汉堡菜单优化 */
            .menu-toggle {
                padding: 8px;
                margin-right: -8px;
            }

            .menu-toggle .bar {
                width: 20px;
                height: 2px;
                margin: 4px 0;
            }

            /* 导航菜单优化 */
            .nav-links {
                top: 60px;
                padding: 10px 0;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(10px);
            }

            .nav-links li {
                width: 100%;
                margin: 0;
            }

            .nav-links a {
                padding: 12px 20px;
                width: 100%;
                font-size: 15px;
                color: #333;
            }

            .nav-links a:hover {
                background: #f5f5f5;
            }

            /* 工具栏展开/收起动画优化 */
            .tool-content {
                transition: all 0.3s ease;
                padding: 12px 15px;
            }

            /* 滚动条优化 */
            ::-webkit-scrollbar {
                width: 4px;
            }

            ::-webkit-scrollbar-track {
                background: #f1f1f1;
            }

            ::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 2px;
            }
        }

        /* 修改 process-card.featured 相关样式 */
        .process-card.featured::after,
        .process-card.updated::after {
            content: '推荐';
            position: absolute;
            top: 10px;
            right: -30px;
            color: white;
            padding: 2px 30px;
            transform: rotate(45deg);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
            box-shadow: var(--shadow-sm);
        }

        /* 添加新的样式用于"最新更新"标签 */
        .process-card.updated::after {
            content: '更新！';
            background: linear-gradient(270deg, #4CAF50, #81C784);
            animation: shining 2s infinite;
            background-size: 200% auto;
        }

        /* 添加闪光动画 */
        @keyframes shining {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* 保持原有的推荐标签样式 */
        .process-card.featured::after {
            background: var(--secondary-color);
        }

        @media (max-width: 768px) {
            /* 优化AI助手整体布局 */
            .ai-section {
                grid-template-columns: 1fr;
                padding: var(--spacing-md);
                gap: var(--spacing-md);
            }

            /* 调整工具栏和聊天窗口高度 */
            .sidebar, .chat-window, .recommendations {
                min-height: auto;
                height: auto;
                max-height: 80vh;
            }

            /* 优化聊天窗口高度 */
            .chat-window {
                height: 60vh;
                order: 2; /* 将聊天窗口移到下方 */
            }

            /* 工具栏调整为在上方 */
            .sidebar {
                order: 1;
                overflow: visible;
            }

            /* 调整工具项间距 */
            .tool-item {
                margin-bottom: var(--spacing-sm);
            }

            /* 优化输入框尺寸 */
            .chat-input-container {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .chat-input {
                width: 100%;
                padding: var(--spacing-sm);
            }

            /* 调整流程卡片间距 */
            .process-cards {
                gap: var(--spacing-sm);
                padding-bottom: var(--spacing-md);
            }

            /* 优化预算计算器输入 */
            .input-group input {
                padding: var(--spacing-sm);
                font-size: var(--font-size-sm);
            }

            /* 修复导航栏遮挡内容问题 */
            .main-content {
                margin-top: 90px; /* 根据导航栏实际高度调整 */
            }

            /* 优化消息显示区域 */
            .chat-messages {
                max-height: 50vh;
                padding: var(--spacing-sm);
            }

            /* 调整工具内容内边距 */
            .tool-content {
                padding: var(--spacing-md);
            }
        }

        /* 添加移动端横向滚动优化 */
        @media (max-width: 480px) {
            .process-cards {
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
            }
            
            .process-card {
                scroll-snap-align: start;
                flex: 0 0 85%;
            }
        }

        @media (max-width: 768px) {
            /* 优化工具栏展开高度 */
            .tool-content.active {
                max-height: 70vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* 调整AI助手整体高度 */
            .ai-section {
                min-height: 100vh;
                grid-template-rows: auto 1fr;
            }

            /* 优化聊天窗口显示 */
            .chat-window {
                height: 65vh;
                min-height: 400px;
                display: flex;
                flex-direction: column;
            }

            /* 调整消息区域高度 */
            .chat-messages {
                max-height: calc(100% - 120px);
                flex-grow: 1;
            }

            /* 工具栏优化 */
            .sidebar {
                max-height: none;
                overflow: visible;
            }

            /* 工具项展开优化 */
            .tool-item {
                margin-bottom: var(--spacing-xs);
            }

            .tool-header {
                padding: var(--spacing-sm) var(--spacing-md);
            }

            /* 输入框组优化 */
            .chat-input-container {
                padding: var(--spacing-sm);
                gap: var(--spacing-xs);
            }

            .chat-input {
                min-height: 44px; /* 符合移动端点击规范 */
            }

            .chat-send-button {
                padding: var(--spacing-sm) var(--spacing-md);
            }

            /* 预算计算器优化 */
            #calculatorContent {
                padding-right: var(--spacing-xs);
            }

            .input-group {
                margin-bottom: var(--spacing-sm);
            }
        }

        @media (max-width: 480px) {
            /* 小屏幕额外优化 */
            .chat-window {
                height: 70vh;
            }
            
            .tool-content {
                padding: var(--spacing-sm);
            }
            
            .process-card {
                flex: 0 0 82%;
            }
        }

        /* 在 style 标签内添加以下样式 */
        .beian-info {
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-sm);
            border-top: 1px solid var(--border-color);
        }

        .beian-link {
            color: var(--text-tertiary);
            font-size: var(--font-size-xs);
            text-decoration: none;
            transition: var(--transition-normal);
        }

        .beian-link:hover {
            color: var(--primary-color);
        }

        /* 每日精选房源部分样式 */
        .featured-houses-section {
            margin-bottom: var(--spacing-xl);
            background: var(--background-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .section-header .view-more-link {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            color: var(--primary-color);
            text-decoration: none;
            font-size: var(--font-size-sm);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-md);
            transition: var(--transition-normal);
            background: var(--primary-bg);
        }

        .section-header .view-more-link:hover {
            background: var(--primary-color);
            color: var(--text-light);
            transform: translateX(var(--spacing-xs));
        }

        .section-header .view-more-link::after {
            content: '→';
            transition: transform var(--transition-normal);
        }

        .section-header .view-more-link:hover::after {
            transform: translateX(var(--spacing-xs));
        }

        .house-card {
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .house-card .card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
            opacity: 0;
            transition: var(--transition-normal);
            display: flex;
            align-items: flex-end;
            padding: var(--spacing-md);
            color: var(--text-light);
            font-size: var(--font-size-sm);
        }

        .house-card:hover .card-overlay {
            opacity: 1;
        }

        .house-card .view-details {
            transform: translateY(20px);
            transition: transform var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .house-card:hover .view-details {
            transform: translateY(0);
        }

        .section-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .filter-tags {
            display: flex;
            gap: var(--spacing-sm);
        }

        .filter-tag {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            background: var(--primary-bg);
            color: var(--primary-color);
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .filter-tag:hover {
            background: var(--primary-light);
            color: var(--text-light);
        }

        .filter-tag.active {
            background: var(--primary-color);
            color: var(--text-light);
        }

        .subscribe-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            background: var(--primary-color);
            color: var(--text-light);
            border: none;
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .subscribe-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .subscribe-btn:active {
            background: var(--primary-dark);
            transform: translateY(0);
        }

        .houses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .house-card {
            background: var(--background-light);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
            border: 1px solid var(--border-color);
            position: relative;
        }

        .house-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary-light);
        }

        .house-image {
            position: relative;
            padding-top: 66.67%;
            background: var(--background-dark);
        }

        .house-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .house-tag {
            position: absolute;
            top: var(--spacing-sm);
            left: var(--spacing-sm);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            background: var(--primary-color);
            color: var(--text-light);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }

        .house-tag.new {
            background: var(--success);
        }

        .favorite-btn {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-normal);
        }

        .favorite-btn:hover {
            transform: scale(1.1);
            background: white;
        }

        .house-info {
            padding: var(--spacing-md);
        }

        .house-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
        }

        .house-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }

        .price {
            color: var(--primary-color);
            font-weight: var(--font-weight-semibold);
        }

        .location {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .house-score {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .score-bar {
            flex-grow: 1;
            height: 4px;
            background: var(--background-dark);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: var(--primary-color);
            border-radius: var(--radius-full);
        }

        .score-value {
            font-weight: var(--font-weight-semibold);
            color: var(--primary-color);
        }

        .house-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }

        .tag {
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            background: var(--primary-bg);
            color: var(--primary-color);
            font-size: var(--font-size-xs);
            font-weight: 500;
        }

        .section-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
        }

        .update-info {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .view-more {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: var(--font-weight-medium);
            transition: var(--transition-normal);
        }

        .view-more:hover {
            color: var(--primary-dark);
        }

        /* 重新设计的租房流程卡片 */
        .process-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .process-card {
            background: var(--background-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-decoration: none;
            color: var(--text-primary);
            transition: var(--transition-normal);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .card-icon {
            font-size: 2rem;
            margin-bottom: var(--spacing-md);
        }

        .process-card h3 {
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-lg);
        }

        .process-card p {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .process-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        /* 快捷工具部分样式 */
        .quick-tools-section {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--background-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .tool-card {
            background: var(--background-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            transition: var(--transition-normal);
            border: 1px solid var(--border-color);
            cursor: pointer;
        }

        .tool-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .tool-icon {
            font-size: 2rem;
            margin-bottom: var(--spacing-md);
            color: var(--primary-color);
        }

        .tool-card h3 {
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-md);
            color: var(--text-primary);
        }

        .tool-card p {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        /* 响应式优化 */
        @media (max-width: 768px) {
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .section-actions {
                width: 100%;
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-tags {
                overflow-x: auto;
                padding-bottom: var(--spacing-xs);
                margin-bottom: var(--spacing-xs);
                -webkit-overflow-scrolling: touch;
            }
            
            .subscribe-btn {
                width: 100%;
                justify-content: center;
            }
            
            .houses-grid {
                grid-template-columns: 1fr;
            }
            
            .process-cards {
                grid-template-columns: 1fr;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 更新主内容区域样式 */
        .main-content {
            padding: var(--spacing-lg);
            max-width: var(--container-max-width);
            margin-left: auto;
            margin-right: auto;
        }

        /* 房源区域通用样式 */
        .featured-houses-section,
        .recommended-houses-section {
            background: var(--background-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-md);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--primary-color);
        }

        .update-badge {
            background: var(--primary-color);
            color: var(--text-light);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .houses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-md);
        }

        /* 房源卡片样式 */
        .house-card {
            background: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            transition: var(--transition-normal);
        }

        .house-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .house-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-sm);
        }

        .house-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            margin: 0;
        }

        .house-tag {
            background: var(--success);
            color: var(--text-light);
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
        }

        .house-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }

        .price {
            color: var(--primary-color);
            font-weight: var(--font-weight-semibold);
        }

        .location {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .house-score {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .score-bar {
            flex-grow: 1;
            height: 4px;
            background: var(--background-dark);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: var(--primary-color);
        }

        .score-value {
            font-weight: var(--font-weight-semibold);
            color: var(--primary-color);
        }

        .house-features {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }

        .feature {
            background: var(--background-dark);
            color: var(--text-secondary);
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
        }

        /* 优质房源推荐特殊样式 */
        .recommendation-info {
            display: flex;
            gap: var(--spacing-sm);
        }

        .info-tag {
            background: var(--primary-light);
            color: var(--text-light);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
        }

        .house-card.highlight {
            background: linear-gradient(to right bottom, var(--background-light), var(--background-hover));
            border: 1px solid var(--primary-light);
        }

        .match-rate {
            background: var(--primary-color);
            color: var(--text-light);
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
        }

        /* 响应式优化 */
        @media (max-width: 768px) {
            .main-content {
                padding: var(--spacing-md);
            }

            .houses-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-sm);
            }

            .house-card {
                padding: var(--spacing-sm);
            }
        }

        /* 新增房源展示区域的样式 */
        .houses-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-xl);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            max-width: var(--container-max-width);
            margin-left: auto;
            margin-right: auto;
            padding: 0 var(--spacing-lg);
            width: 100%;
            box-sizing: border-box;
        }

        .featured-houses-section,
        .recommended-houses-section {
            background: var(--background-light);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            height: 600px;
            overflow-y: auto;
            box-shadow: var(--shadow-sm);
        }

        .featured-houses-section {
            max-width: calc(100% - var(--spacing-xl));
        }

        .recommended-houses-section {
            max-width: 100%;
        }

        .houses-grid {
            flex: 1;
            overflow-y: auto;
            padding-right: var(--spacing-sm);
            margin-top: var(--spacing-md);
            display: grid;
            gap: var(--spacing-md);
        }

        .featured-houses-section .houses-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .recommended-houses-section .houses-grid {
            grid-template-columns: 1fr;
        }

        .houses-grid::-webkit-scrollbar {
            width: 4px;
        }

        .houses-grid::-webkit-scrollbar-track {
            background: var(--background-dark);
            border-radius: var(--radius-full);
        }

        .houses-grid::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: var(--radius-full);
        }

        .house-card {
            background: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            transition: var(--transition-normal);
        }

        .house-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .house-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-sm);
        }

        .house-title {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            margin: 0;
        }

        .house-tag {
            background: var(--success);
            color: var(--text-light);
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
        }

        .house-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }

        .price {
            color: var(--primary-color);
            font-weight: var(--font-weight-semibold);
        }

        .location {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .house-score {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .score-bar {
            flex-grow: 1;
            height: 4px;
            background: var(--background-dark);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: var(--primary-color);
        }

        .score-value {
            font-weight: var(--font-weight-semibold);
            color: var(--primary-color);
        }

        .house-features {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }

        .feature {
            background: var(--background-dark);
            color: var(--text-secondary);
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
        }

        /* 优质房源推荐特殊样式 */
        .recommendation-info {
            display: flex;
            gap: var(--spacing-sm);
        }

        .info-tag {
            background: var(--primary-light);
            color: var(--text-light);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
        }

        .house-card.highlight {
            background: linear-gradient(to right bottom, var(--background-light), var(--background-hover));
            border: 1px solid var(--primary-light);
        }

        .match-rate {
            background: var(--primary-color);
            color: var(--text-light);
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
        }

        /* 响应式优化 */
        @media (max-width: 1200px) {
            .houses-container {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }

            .featured-houses-section,
            .recommended-houses-section {
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .featured-houses-section .houses-grid {
                grid-template-columns: 1fr;
            }

            .house-card {
                padding: var(--spacing-sm);
            }
        }

        /* 添加悬浮窗样式 */
        .floating-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--background-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 60px;
            transition: all 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .floating-widget.expanded {
            width: 360px;
            height: 500px;
        }

        .widget-toggle {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .widget-content {
            display: none;
            height: calc(100% - 60px);
            background: var(--background-light);
        }

        .floating-widget.expanded .widget-content {
            display: block;
        }

        .widget-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }

        .widget-tab {
            flex: 1;
            padding: var(--spacing-sm);
            text-align: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            border: none;
            background: none;
            font-size: var(--font-size-sm);
        }

        .widget-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }

        .widget-panels {
            height: calc(100% - 41px);
            overflow-y: auto;
        }

        .widget-panel {
            display: none;
            padding: var(--spacing-md);
            height: 100%;
        }

        .widget-panel.active {
            display: block;
        }

        @media (max-width: 768px) {
            .floating-widget {
                bottom: 20px;
                right: 20px;
            }

            .floating-widget.expanded {
                width: calc(100% - 40px);
                height: 60vh;
            }
        }

        /* 悬浮窗样式 */
        .floating-widget {
            position: fixed;
            top: 100px;
            right: 30px;
            background: var(--background-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 60px;
            height: 60px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .floating-widget.expanded {
            width: 360px;
            height: 500px;
            background: var(--background-light);
        }

        .widget-toggle {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--background-light);
            color: var(--primary-color);
            cursor: pointer;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 24px;
            transition: all 0.3s ease;
            position: absolute;
            top: 0;
            right: 0;
        }

        .widget-toggle:hover {
            background: var(--primary-bg);
            transform: scale(1.05);
        }

        .widget-content {
            display: none;
            height: calc(100% - 60px);
            background: var(--background-light);
            margin-top: 60px;
        }

        .floating-widget.expanded .widget-content {
            display: block;
        }

        .widget-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background: var(--background-light);
        }

        .widget-tab {
            flex: 1;
            padding: var(--spacing-sm);
            text-align: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            border: none;
            background: none;
            font-size: var(--font-size-sm);
        }

        .widget-tab:hover {
            color: var(--primary-color);
            background: var(--primary-bg);
        }

        .widget-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            font-weight: var(--font-weight-medium);
        }

        .widget-panels {
            height: calc(100% - 41px);
            overflow-y: auto;
        }

        .widget-panel {
            display: none;
            padding: var(--spacing-md);
            height: 100%;
        }

        .widget-panel.active {
            display: block;
        }

        /* AI助手面板样式 */
        .ai-chat-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-sm);
            background: var(--background-dark);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
        }

        .message {
            margin-bottom: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            max-width: 85%;
        }

        .message.system {
            background: var(--primary-bg);
            color: var(--primary-color);
            text-align: center;
            max-width: 100%;
            margin: var(--spacing-md) 0;
        }

        .message.user {
            background: var(--primary-color);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: var(--radius-sm);
        }

        .message.ai {
            background: white;
            color: var(--text-primary);
            margin-right: auto;
            border-bottom-left-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .chat-input-container {
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: var(--background-light);
            border-top: 1px solid var(--border-color);
        }

        .chat-input {
            flex: 1;
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
        }

        .chat-send-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            .floating-widget {
                top: auto;
                bottom: 20px;
                right: 20px;
            }

            .floating-widget.expanded {
                width: calc(100% - 40px);
                height: 60vh;
                right: 20px;
                bottom: 20px;
            }
        }

        /* 在 style 标签内添加 */
        .reminder-badge {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            background: var(--error);
            color: var(--text-light);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            box-shadow: 0 2px 4px rgba(211, 47, 47, 0.2);
        }
    </style>

</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="logo">Qrent</div>
        <button class="menu-toggle d-md-none">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </button>
        <ul class="nav-links">
            <li><a href="#favorites">我的收藏</a></li>
            <li>
                <div class="login-circle" id="loginStatus" onclick="window.location.href='/login'">
                    <span class="login-text">登录</span>
                </div>
            </li>
        </ul>
    </nav>

    <div class="main-content">
        <!-- 租房流程部分 -->
        <section id="process" class="process-section">
            <h2>租房流程</h2>
            <div class="process-cards">
                <a href="guides.html" class="process-card">
                    <div class="card-icon">📚</div>
                    <h3>租房攻略</h3>
                    <p>查看详细指南</p>
                </a>
                <a href="housing-filter.html" class="process-card featured">
                    <div class="card-icon">🔍</div>
                    <h3>找房筛选</h3>
                    <p>智能筛选合适房源</p>
                </a>
                <a href="rental-letter-generator.html" class="process-card">
                    <div class="reminder-badge">0/6</div>
                    <div class="card-icon">📝</div>
                    <h3>申请材料</h3>
                    <p>生成租房申请信</p>
                </a>
            </div>
        </section>

        <!-- 房源展示区域 -->
        <div class="houses-container">
            <!-- 每日精选房源部分 -->
            <section id="featured-houses" class="featured-houses-section">
                <div class="section-header">
                    <h2>每日房源</h2>
                    <div class="section-actions">
                        <span class="update-badge">今日更新: 28套</span>
                        <a href="daily-houses.html" class="view-more-link">查看更多房源</a>
                    </div>
                </div>
                <div class="houses-grid">
                    <!-- 房源卡片1 -->
                    <div class="house-card" data-house-id="1">
                        <div class="house-header">
                            <h3 class="house-title">Kensington - 2室1卫</h3>
                            <span class="house-tag new">新上线</span>
                        </div>
                        <div class="house-meta">
                            <span class="price">$650/周</span>
                            <span class="location">距UNSW 5分钟</span>
                        </div>
                        <div class="house-features">
                            <span class="feature">2室1卫</span>
                            <span class="feature">带家具</span>
                            <span class="feature">拎包入住</span>
                        </div>
                        <div class="card-overlay">
                            <div class="view-details">
                                点击查看详情 →
                            </div>
                        </div>
                    </div>
                    <!-- 房源卡片2 -->
                    <div class="house-card">
                        <div class="house-header">
                            <h3 class="house-title">Randwick - 3室2卫</h3>
                            <span class="house-tag">优选</span>
                        </div>
                        <div class="house-meta">
                            <span class="price">$850/周</span>
                            <span class="location">距UNSW 8分钟</span>
                        </div>
                        <div class="house-features">
                            <span class="feature">3室2卫</span>
                            <span class="feature">花园</span>
                            <span class="feature">停车位</span>
                        </div>
                    </div>
                    <!-- 房源卡片3 -->
                    <div class="house-card">
                        <div class="house-header">
                            <h3 class="house-title">Kingsford - 1室1卫</h3>
                            <span class="house-tag new">新上线</span>
                        </div>
                        <div class="house-meta">
                            <span class="price">$450/周</span>
                            <span class="location">距UNSW 3分钟</span>
                        </div>
                        <div class="house-features">
                            <span class="feature">1室1卫</span>
                            <span class="feature">独立厨房</span>
                            <span class="feature">包水电</span>
                        </div>
                    </div>
                    <!-- 房源卡片4 -->
                    <div class="house-card">
                        <div class="house-header">
                            <h3 class="house-title">Maroubra - 2室1卫</h3>
                            <span class="house-tag">近海滩</span>
                        </div>
                        <div class="house-meta">
                            <span class="price">$580/周</span>
                            <span class="location">距UNSW 15分钟</span>
                        </div>
                        <div class="house-features">
                            <span class="feature">2室1卫</span>
                            <span class="feature">阳台</span>
                            <span class="feature">近海滩</span>
                        </div>
                    </div>
                    <!-- 房源卡片5-10 -->
                    <div class="house-card">
                        <div class="house-header">
                            <h3 class="house-title">Coogee - 2室2卫</h3>
                            <span class="house-tag">海景房</span>
                        </div>
                        <div class="house-meta">
                            <span class="price">$750/周</span>
                            <span class="location">距UNSW 12分钟</span>
                        </div>
                        <div class="house-features">
                            <span class="feature">2室2卫</span>
                            <span class="feature">海景</span>
                            <span class="feature">全新装修</span>
                        </div>
                    </div>
                    <!-- 继续添加其他房源... -->
                </div>
            </section>

            <!-- 优质房源推荐部分 -->
            <section id="recommended-houses" class="recommended-houses-section">
                <div class="section-header">
                    <h2>智能推荐</h2>
                    <div class="recommendation-info">
                        <span class="info-tag">智能匹配</span>
                        <span class="info-tag">高性价比</span>
                    </div>
                </div>
                <div class="houses-grid">
                    <!-- 推荐房源1 -->
                    <div class="house-card highlight">
                        <div class="house-header">
                            <h3 class="house-title">Randwick - 3室2卫</h3>
                            <span class="match-rate">匹配度 95%</span>
                        </div>
                        <div class="house-meta">
                            <span class="price">$850/周</span>
                            <span class="location">距UNSW 8分钟</span>
                        </div>
                        <div class="house-features">
                            <span class="feature">3室2卫</span>
                            <span class="feature">花园</span>
                            <span class="feature">停车位</span>
                        </div>
                    </div>
                    <!-- 推荐房源2 -->
                    <div class="house-card highlight">
                        <div class="house-header">
                            <h3 class="house-title">Maroubra - 2室1卫</h3>
                            <span class="match-rate">匹配度 90%</span>
                        </div>
                        <div class="house-meta">
                            <span class="price">$580/周</span>
                            <span class="location">距UNSW 15分钟</span>
                        </div>
                        <div class="house-features">
                            <span class="feature">2室1卫</span>
                            <span class="feature">阳台</span>
                            <span class="feature">近海滩</span>
                        </div>
                    </div>
                    <!-- 推荐房源3 -->
                    <div class="house-card highlight">
                        <div class="house-header">
                            <h3 class="house-title">Kingsford - 2室1卫</h3>
                            <span class="match-rate">匹配度 88%</span>
                        </div>
                        <div class="house-meta">
                            <span class="price">$600/周</span>
                            <span class="location">距UNSW 5分钟</span>
                        </div>
                        <div class="house-features">
                            <span class="feature">2室1卫</span>
                            <span class="feature">带家具</span>
                            <span class="feature">安静社区</span>
                        </div>
                    </div>
                    <!-- 继续添加其他推荐房源... -->
                </div>
            </section>
        </div>

        <!-- 页脚 -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>联系方式</h3>
                    <ul class="guide-links">
                        <li>
                            <a href="mailto:yyzyfish5@gmail.com" class="social-link">
                                <span>📧</span> yyzyfish5@gmail.com
                            </a>
                        </li>
                        <li>
                            <a href="https://www.xiaohongshu.com/user/profile/609ca560000000000101fd15" target="_blank" class="social-link">
                                <span>📱</span> 小红书：我不是闲狗
                            </a>
                        </li>
                    </ul>
                    <div class="beian-info">
                        <a href="https://beian.miit.gov.cn/" target="_blank" class="beian-link">
                            网页备案号:粤ICP备2025363367号-1
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>关于我们</h3>
                    <p>Qrent 专注于为赴澳洲的留学生提供全面且贴心的租房解决方案，让租房流程更加高效、便捷，为海外留学生活打造一个安心的起点。</p>
                    <div class="visit-stats">
                        <div class="stats-container">
                            <div class="stat-item">
                                <span class="stat-icon">👥</span>
                                <span class="stat-label">总访问量:</span>
                                <span id="totalVisits" class="stat-value">-</span>
                            </div>
                            <div class="stat-divider"></div>
                            <div class="stat-item">
                                <span class="stat-icon">📊</span>
                                <span class="stat-label">今日访问:</span>
                                <span id="todayVisits" class="stat-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>快速导航</h3>
                    <ul class="guide-links">
                        <li><a href="#process">租房流程</a></li>
                        <li><a href="#ai">AI 助手</a></li>
                        <li><a href="#guides">攻略导航</a></li>
                    </ul>
                </div>
            </div>
        </footer>
    </div>

    <!-- 浮动按钮 -->
    <div class="floating-buttons">
        <button class="floating-button" onclick="alert('需要帮助吗？')">?</button>
        <button class="floating-button" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">↑</button>
    </div>

    <!-- 添加悬浮窗 -->
    <div class="floating-widget" id="floatingWidget">
        <button class="widget-toggle" id="widgetToggle">🤖</button>
        <div class="widget-content">
            <div class="widget-tabs">
                <button class="widget-tab active" data-panel="ai">AI助手</button>
                <button class="widget-tab" data-panel="area">区域评分</button>
            </div>
            <div class="widget-panels">
                <div class="widget-panel active" id="aiPanel">
                    <div class="ai-chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="message system" id="welcomeMessage">
                                您好！我是您的租房助手，请问有什么可以帮您的吗？
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <input type="text" class="chat-input" id="chatInput" placeholder="请输入您的问题...">
                            <button class="chat-send-btn" onclick="sendMessage()">发送</button>
                        </div>
                    </div>
                </div>
                <div class="widget-panel" id="areaPanel">
                    <div class="area-score-container">
                        <div class="area-results" id="areaResults"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 添加 UUID polyfill
        if (!crypto.randomUUID) {
            crypto.randomUUID = function() {
                return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
                );
            };
        }

        // 修改导航链接的点击事件处理
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', (e) => {
                // 如果是登录链接，让它正常跳转
                if (link.classList.contains('login-link')) {
                    return;
                }
                // 其他导航链接保持原有的平滑滚动行为
                e.preventDefault();
                const href = link.getAttribute('href');
                if (href.startsWith('#')) {
                    const target = document.querySelector(href);
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
        });

        // 打开预算计算器
        function openBudgetCalculator() {
            document.getElementById('ai').scrollIntoView({ behavior: 'smooth' });
            const calculatorContent = document.getElementById('calculatorContent');
            const calculatorHeader = calculatorContent.previousElementSibling;
            const calculatorIcon = calculatorHeader.querySelector('.toggle-icon');
            
            if (!calculatorContent.classList.contains('active')) {
                calculatorContent.classList.add('active');
                calculatorIcon.style.transform = 'rotate(180deg)';
            }
        }

        // 打开租房攻略导航
        function openRentalGuide() {
            document.getElementById('ai').scrollIntoView({ behavior: 'smooth' });
            const guideContent = document.getElementById('guideContent');
            const guideHeader = guideContent.previousElementSibling;
            const guideIcon = guideHeader.querySelector('.toggle-icon');
            
            if (!guideContent.classList.contains('active')) {
                guideContent.classList.add('active');
                guideIcon.style.transform = 'rotate(180deg)';
            }
        }

        // 修改租房流程卡片的点击事件
        document.querySelectorAll('.process-card').forEach((card, index) => {
            card.onclick = null; // 清除现有的点击事件
            if (index === 0) { // 第一个卡片：确定预算
                card.onclick = openBudgetCalculator;
            } else if (index === 1) { // 第二个卡片：选择区域
                card.onclick = openAreaSelector;
            } else if (index === 3) { // 第四个卡片：租房攻略导航
                card.onclick = openRentalGuide;
            }
        });

        // 添加区域选择工具的打开函数
        function openAreaSelector() {
            document.getElementById('ai').scrollIntoView({ behavior: 'smooth' });
            const areaContent = document.getElementById('areaContent');
            const areaHeader = areaContent.previousElementSibling;
            const areaIcon = areaHeader.querySelector('.toggle-icon');
            
            if (!areaContent.classList.contains('active')) {
                areaContent.classList.add('active');
                areaIcon.style.transform = 'rotate(180deg)';
            }
        }

        function sendQuickQuestion(question) {
            const chatInput = document.getElementById('chatInput');
            chatInput.value = question;
            sendMessage();
        }

        function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            if (!message) return;

            const chatMessages = document.getElementById('chatMessages');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const quickQuestions = document.querySelector('.quick-questions');
            
            // 移除欢迎消息和快速问题
            if (welcomeMessage) welcomeMessage.remove();
            if (quickQuestions) quickQuestions.remove();
            
            // 添加用户消息
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.textContent = message;
            chatMessages.appendChild(userMessage);
            
            // 清空输入框
            chatInput.value = '';
            
            // 添加等待消息
            const waitingMessage = document.createElement('div');
            waitingMessage.className = 'message ai waiting';
            waitingMessage.textContent = '正在思考...';
            chatMessages.appendChild(waitingMessage);
            
            // 调用 AI API
            callAIAPI(message);
            
            // 滚动到底部
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // 获取当前环境的API基础URL
        function getApiBaseUrl() {
            const hostname = window.location.hostname;
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:2781';
            }
            return 'http://134.175.168.147:2781';
        }

        // 添加 AI API 调用函数
        async function callAIAPI(message) {
            try {
                const baseUrl = getApiBaseUrl();
                const response = await fetch(`${baseUrl}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Origin': window.location.origin
                    },
                    credentials: 'include',
                    body: JSON.stringify({ message })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // 移除等待消息
                const waitingMessage = document.querySelector('.message.waiting');
                if (waitingMessage) {
                    waitingMessage.remove();
                }

                // 添加 AI 回复
                const chatMessages = document.getElementById('chatMessages');
                const aiMessage = document.createElement('div');
                aiMessage.className = 'message ai';
                
                // 处理不同的响应格式
                let content = '';
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    content = data.choices[0].message.content;
                } else if (data.output && data.output.text) {
                    content = data.output.text;
                } else if (typeof data === 'string') {
                    content = data;
                } else {
                    content = '抱歉，我暂时无法回答您的问题。';
                }
                
                aiMessage.textContent = content;
                chatMessages.appendChild(aiMessage);
            } catch (error) {
                console.error('Error:', error);
                const chatMessages = document.getElementById('chatMessages');
                const errorMessage = document.createElement('div');
                errorMessage.className = 'message ai error';
                errorMessage.textContent = '抱歉，发生了错误，请稍后重试。';
                chatMessages.appendChild(errorMessage);
                
                // 移除等待消息
                const waitingMessage = document.querySelector('.message.waiting');
                if (waitingMessage) {
                    waitingMessage.remove();
                }
            }
            
            // 滚动到底部
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // 添加回车发送功能
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function toggleCalculator() {
            const toolList = document.getElementById('toolList');
            const calculatorContent = document.getElementById('calculatorContent');
            
            if (calculatorContent.style.display === 'none') {
                toolList.style.display = 'none';
                calculatorContent.style.display = 'block';
                simpleCalculate();
            } else {
                toolList.style.display = 'block';
                calculatorContent.style.display = 'none';
            }
        }

        // 预算计算器功能
        function formatNumber(num) {
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function simpleCalculate(sourceInput) {
            const rentRatio = parseFloat(document.getElementById('rentRatio').value) || 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 0;
            const courseCount = 8; // 固定课程数量为8
            const courseFee = parseFloat(document.getElementById('courseFee').value.replace(/,/g, '')) || 0;
            const totalCostCNY = parseFloat(document.getElementById('totalCostCNY').value.replace(/,/g, '')) || 0;
            const weeklyRent = parseFloat(document.getElementById('weeklyRent').value.replace(/,/g, '')) || 0;
            const weeklyLiving = parseFloat(document.getElementById('weeklyLiving').value.replace(/,/g, '')) || 0;
            
            const totalTuition = courseCount * courseFee;
            const totalTuitionCNY = totalTuition * exchangeRate;

            if (sourceInput === 'weeklyLiving') {
                // 从每周生活费倒算房租和总支出
                const yearlyLiving = weeklyLiving * 52;
                const yearlyRent = yearlyLiving / ((1 - rentRatio / 100) / (rentRatio / 100));
                const newWeeklyRent = yearlyRent / 52;
                const totalLivingCostAUD = yearlyLiving + yearlyRent;
                const totalLivingCostCNY = totalLivingCostAUD * exchangeRate;
                const newTotalCostCNY = totalLivingCostCNY + totalTuitionCNY;

                document.getElementById('weeklyRent').value = formatNumber(newWeeklyRent);
                document.getElementById('totalCostCNY').value = formatNumber(newTotalCostCNY);

                updateResult(newTotalCostCNY, yearlyRent, totalLivingCostCNY, totalTuitionCNY, weeklyLiving, exchangeRate);
            } else if (sourceInput === 'weeklyRent') {
                // 从每周房租正算总支出和生活费
                const yearlyRent = weeklyRent * 52;
                const totalLivingCostAUD = yearlyRent / (rentRatio / 100);
                const newWeeklyLiving = (totalLivingCostAUD - yearlyRent) / 52;
                const totalLivingCostCNY = totalLivingCostAUD * exchangeRate;
                const newTotalCostCNY = totalLivingCostCNY + totalTuitionCNY;
                
                document.getElementById('weeklyLiving').value = formatNumber(newWeeklyLiving);
                document.getElementById('totalCostCNY').value = formatNumber(newTotalCostCNY);
                
                updateResult(newTotalCostCNY, yearlyRent, totalLivingCostCNY, totalTuitionCNY, newWeeklyLiving, exchangeRate);
            } else {
                // 从总支出倒算每周房租和生活费
                const totalLivingCostCNY = totalCostCNY - totalTuitionCNY;
                const totalLivingCostAUD = totalLivingCostCNY / exchangeRate;
                const yearlyRent = totalLivingCostAUD * (rentRatio / 100);
                const newWeeklyRent = yearlyRent / 52;
                const newWeeklyLiving = (totalLivingCostAUD - yearlyRent) / 52;
                
                document.getElementById('weeklyRent').value = formatNumber(newWeeklyRent);
                document.getElementById('weeklyLiving').value = formatNumber(newWeeklyLiving);
                
                updateResult(totalCostCNY, yearlyRent, totalLivingCostCNY, totalTuitionCNY, newWeeklyLiving, exchangeRate);
            }
        }

        function updateResult(totalCostCNY, yearlyRent, totalLivingCostCNY, totalTuitionCNY, weeklyLiving, exchangeRate) {
            document.getElementById('simpleResult').innerHTML = `
                <h4>预算结果</h4>
                <p>年度总支出：${formatNumber(totalCostCNY)} CNY</p>
                <p>其中：</p>
                <p>- 房租支出：${formatNumber(yearlyRent * exchangeRate)} CNY</p>
                <p>- 生活费支出：${formatNumber(totalLivingCostCNY - yearlyRent * exchangeRate)} CNY</p>
                <p>- 学费支出：${formatNumber(totalTuitionCNY)} CNY</p>
            `;
        }

        // 为所有输入框添加千分位格式化
        document.querySelectorAll('.input-group input').forEach(input => {
            input.addEventListener('input', function(e) {
                // 只保留数字和逗号
                let value = this.value.replace(/[^\d,]/g, '');
                // 移除所有逗号后解析
                value = value.replace(/,/g, '');
                if (value) {
                    // 限制输入长度
                    if (value.length > 10) {
                        value = value.slice(0, 10);
                    }
                    const formattedValue = formatNumber(parseInt(value));
                    this.value = formattedValue;
                }
            });
        });

        // 工具切换功能
        function toggleTool(toolId) {
            const content = document.getElementById(toolId + 'Content');
            const header = content.previousElementSibling;
            const icon = header.querySelector('.toggle-icon');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('active');
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // 更新区域数据，严格按照图表数据
        const areaData = {
            'Kensington': {
                affordable: 20,
                amenity: 19,
                accessibility: 20,
                schoolCommute: 18.2,
                housingQuality: 14.81,
                safety: -3.33
            },
            'Rosebery': {
                affordable: 16,
                amenity: 17,
                accessibility: 19,
                schoolCommute: 16.4,
                housingQuality: 16.05,
                safety: 0
            },
            'Coogee': {
                affordable: 18,
                amenity: 16,
                accessibility: 20,
                schoolCommute: 16.7,
                housingQuality: 15.28,
                safety: -1.67
            },
            'Randwick': {
                affordable: 14,
                amenity: 18,
                accessibility: 20,
                schoolCommute: 17.9,
                housingQuality: 15.50,
                safety: -1.11
            },
            'Kingsford': {
                affordable: 16,
                amenity: 19,
                accessibility: 20,
                schoolCommute: 20.0,
                housingQuality: 14.06,
                safety: -3.33
            },
            'Zetland': {
                affordable: 14,
                amenity: 16,
                accessibility: 20,
                schoolCommute: 16.5,
                housingQuality: 14.94,
                safety: -2.22
            },
            'Paddington': {
                affordable: 18,
                amenity: 17,
                accessibility: 18,
                schoolCommute: 13.1,
                housingQuality: 14.03,
                safety: -1.11
            },
            'Bondi': {
                affordable: 16,
                amenity: 17,
                accessibility: 20,
                schoolCommute: 14.3,
                housingQuality: 15.26,
                safety: -2.78
            },
            'Maroubra': {
                affordable: 16,
                amenity: 20,
                accessibility: 19,
                schoolCommute: 15.0,
                housingQuality: 15.44,
                safety: -4.44
            },
            'Botany': {
                affordable: 22,
                amenity: 16,
                accessibility: 9,
                schoolCommute: 12.3,
                housingQuality: 15.14,
                safety: 0
            },
            'Alexandria': {
                affordable: 16,
                amenity: 19,
                accessibility: 19,
                schoolCommute: 15.1,
                housingQuality: 15.19,
                safety: -4.44
            },
            'Mascot': {
                affordable: 18,
                amenity: 15,
                accessibility: 18,
                schoolCommute: 13.8,
                housingQuality: 15.20,
                safety: -3.33
            },
            'Eastlakes': {
                affordable: 18,
                amenity: 15,
                accessibility: 18,
                schoolCommute: 16.2,
                housingQuality: 15.38,
                safety: -5
            },
            'Woollcreek': {
                affordable: 22,
                amenity: 14,
                accessibility: 13,
                schoolCommute: 9.0,
                housingQuality: 15.22,
                safety: -1.67
            },
            'Hillsdale': {
                affordable: 20,
                amenity: 11,
                accessibility: 13,
                schoolCommute: 12.8,
                housingQuality: 14.86,
                safety: -2.22
            },
            'Eastgardens': {
                affordable: 18,
                amenity: 16,
                accessibility: 14,
                schoolCommute: 14.1,
                housingQuality: 16.76,
                safety: -6.67
            },
            'Waterloo': {
                affordable: 14,
                amenity: 20,
                accessibility: 20,
                schoolCommute: 16.5,
                housingQuality: 15.32,
                safety: -9.33
            },
            'Matraville': {
                affordable: 20,
                amenity: 11,
                accessibility: 12,
                schoolCommute: 13.3,
                housingQuality: 14.75,
                safety: -3.33
            },
            'Redfern': {
                affordable: 14,
                amenity: 17,
                accessibility: 20,
                schoolCommute: 14.9,
                housingQuality: 16.53,
                safety: -14.67
            }
        };

        // 获取所有滑条的值
        function getPreferences() {
            return {
                affordable: parseInt(document.getElementById('affordableSlider').value),
                amenity: parseInt(document.getElementById('amenitySlider').value),
                accessibility: parseInt(document.getElementById('accessibilitySlider').value),
                schoolCommute: parseInt(document.getElementById('schoolCommuteSlider').value),
                housingQuality: parseInt(document.getElementById('housingQualitySlider').value),
                safety: parseInt(document.getElementById('safetySlider').value)
            };
        }

        // 计算区域得分
        function calculateAreaScore(areaStats, preferences) {
            // 直接将每个指标乘以对应的权重并求和
            let totalScore = 
                areaStats.affordable * preferences.affordable +
                areaStats.amenity * preferences.amenity +
                areaStats.accessibility * preferences.accessibility +
                areaStats.schoolCommute * preferences.schoolCommute +
                areaStats.housingQuality * preferences.housingQuality +
                areaStats.safety * preferences.safety;
            
            return totalScore;
        }

        // 更新结果显示
        function updateResults() {
            const preferences = getPreferences();
            const results = [];
            
            // 计算每个区域的得分
            for (const [areaName, stats] of Object.entries(areaData)) {
                const score = calculateAreaScore(stats, preferences);
                results.push({ name: areaName, score, stats });
            }
            
            // 按得分排序
            results.sort((a, b) => b.score - a.score);
            
            // 更新显示，只显示前10名
            const resultsContainer = document.getElementById('areaResults');
            resultsContainer.innerHTML = '';
            
            results.slice(0, 10).forEach((result, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'area-result-item';
                resultItem.innerHTML = `
                    <div class="area-result-rank">${index + 1}</div>
                    <div class="area-result-info">
                        <div class="area-result-name">${result.name}</div>
                        <div class="area-result-score">
                            <div class="area-result-score-bar">
                                <div class="area-result-score-fill" style="width: ${(result.score/results[0].score)*100}%"></div>
                            </div>
                            <div class="area-result-score-value">${result.score.toFixed(1)}</div>
                        </div>
                    </div>
                `;
                resultsContainer.appendChild(resultItem);
            });
        }

        // 添加样式以使排名更紧凑
        const additionalStyle = document.createElement('style');
        additionalStyle.textContent = `
            .area-result-item {
                padding: var(--spacing-xs) var(--spacing-sm);
                margin-bottom: var(--spacing-xs);
            }
            .area-result-name {
                font-size: var(--font-size-md);
                margin-bottom: var(--spacing-xs);
            }
            .area-result-details {
                font-size: 11px;
            }
            .area-result-details span {
                padding: 1px 4px;
            }
            .area-result-rank {
                font-size: var(--font-size-lg);
                min-width: 24px;
            }
        `;
        document.head.appendChild(additionalStyle);

        // 为所有滑条添加事件监听
        document.querySelectorAll('.preference-slider').forEach(slider => {
            // 使用 input 事件而不是 change 事件，实现实时更新
            slider.addEventListener('input', () => {
                updateResults();
                // 更新滑块值显示
                const valueDisplay = slider.parentElement.querySelector('.slider-value');
                if (valueDisplay) {
                    valueDisplay.textContent = slider.value;
                }
            });
        });

        // 添加滑块当前值显示的样式
        const style = document.createElement('style');
        style.textContent = `
            .area-result-details {
            display: flex;
                flex-wrap: wrap;
                gap: var(--spacing-xs);
                margin-top: var(--spacing-xs);
                font-size: var(--font-size-xs);
                color: var(--text-secondary);
            }
            .area-result-details span {
                background: var(--background-dark);
                padding: 2px 6px;
                border-radius: var(--radius-sm);
            }
            .slider-value {
                position: absolute;
                right: var(--spacing-sm);
                top: var(--spacing-xs);
                background: var(--primary-color);
                color: white;
                padding: 2px 6px;
                border-radius: var(--radius-sm);
                font-size: var(--font-size-xs);
            }
            .slider-group {
                position: relative;
            }
        `;
        document.head.appendChild(style);

        // 为每个滑块添加当前值显示
        document.querySelectorAll('.slider-group').forEach(group => {
            const slider = group.querySelector('.preference-slider');
            const valueDisplay = document.createElement('span');
            valueDisplay.className = 'slider-value';
            valueDisplay.textContent = slider.value;
            group.appendChild(valueDisplay);
        });

        // 初始化结果
        updateResults();

        // 获取访问统计数据
        async function fetchVisitStats() {
            try {
                const baseUrl = getApiBaseUrl();
                const response = await fetch(`${baseUrl}/api/visit-stats`, {
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch stats');
                }
                
                const data = await response.json();
                
                // 使用可选链和空值合并操作符来安全地更新DOM
                const totalVisits = document.getElementById('totalVisits');
                const todayVisits = document.getElementById('todayVisits');
                
                if (totalVisits) totalVisits.textContent = data?.total ?? '-';
                if (todayVisits) todayVisits.textContent = data?.today ?? '-';
            } catch (error) {
                console.warn('获取访问统计失败:', error);
                // 在获取失败时显示默认值
                const elements = ['totalVisits', 'todayVisits'];
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = '-';
                });
            }
        }

        // 页面加载时获取统计数据
        window.addEventListener('load', fetchVisitStats);

        // 记录访问
        async function recordVisit() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5秒超时

                const visitData = {
                    page_url: window.location.pathname,
                    referrer: document.referrer,
                    user_agent: navigator.userAgent
                };

                const baseUrl = getApiBaseUrl();
                const response = await fetch(`${baseUrl}/api/record-visit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(visitData),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error('访问记录失败');
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.warn('访问记录请求超时');
                } else {
                    console.warn('访问记录失败:', error);
                }
            }
        }

        // 页面加载时执行
        window.addEventListener('load', () => {
            recordVisit();
            fetchVisitStats();
        });

        // 方式二：在 JavaScript 中添加事件监听（推荐）
        // 在 script 标签内添加以下代码
        document.addEventListener('DOMContentLoaded', function() {
            const loginButton = document.getElementById('loginStatus');
            loginButton.addEventListener('click', function() {
                window.location.href = 'login.html';
            });
        });

        // 添加检查登录状态和更新按钮的函数
        function updateLoginButtonStatus() {
            const loginButton = document.getElementById('loginStatus');
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user'));
            
            if (token && user) {
                // 用户已登录 - 创建带下拉菜单的按钮
                loginButton.innerHTML = `
                    <div class="user-menu-container">
                        <div class="login-circle logged-in">
                            <span class="login-text">${user.username.charAt(0).toUpperCase()}</span>
                        </div>
                        <div class="dropdown-menu" style="display: none;">
                            <div class="menu-item username-item disabled">用户名：${user.username}</div>
                            <div class="menu-item logout-item">退出登录</div>
                        </div>
                    </div>
                `;
                
                // 获取下拉菜单元素
                const dropdownMenu = loginButton.querySelector('.dropdown-menu');
                const logoutItem = loginButton.querySelector('.logout-item');
                
                // 点击头像显示/隐藏下拉菜单
                loginButton.querySelector('.login-circle').onclick = function(e) {
                    e.stopPropagation();
                    dropdownMenu.style.display = dropdownMenu.style.display === 'none' ? 'block' : 'none';
                };
                
                // 阻止用户名项的点击事件
                const usernameItem = loginButton.querySelector('.username-item');
                usernameItem.onclick = function(e) {
                    e.stopPropagation();  // 阻止事件冒泡
                    return false;  // 阻止默认行为
                };
                
                // 点击登出选项
                logoutItem.onclick = async function(e) {
                    e.stopPropagation();
                    try {
                        const token = localStorage.getItem('token');
                        if (!token) {
                            // 如果没有 token，直接清除本地存储
                            localStorage.removeItem('token');
                            localStorage.removeItem('user');
                            updateLoginButtonStatus();
                            return;
                        }

                        const baseUrl = getApiBaseUrl();
                        const response = await fetch(`${baseUrl}/api/logout`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`  // 确保 token 格式正确
                            },
                            credentials: 'include'  // 添加这行以包含 cookies
                        });

                        // 无论响应如何，都清除本地存储
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        updateLoginButtonStatus();

                    } catch (error) {
                        console.warn('登出处理:', error);
                        // 即使出错也清除本地存储
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        updateLoginButtonStatus();
                    }
                };
                
                // 点击页面其他地方关闭下拉菜单
                document.addEventListener('click', function() {
                    dropdownMenu.style.display = 'none';
                });
            } else {
                // 用户未登录
                loginButton.innerHTML = `
                    <div class="login-circle">
                        <span class="login-text">登录</span>
                    </div>
                `;
                loginButton.onclick = function() {
                    window.location.href = 'login.html';
                };
            }
        }

        // 在 DOMContentLoaded 事件中调用
        document.addEventListener('DOMContentLoaded', function() {
            updateLoginButtonStatus();
            
            // 使用 Promise 包装异步操作
            const initializeApp = async () => {
                try {
                    await recordVisit();
                    await fetchVisitStats();
                } catch (error) {
                    console.warn('初始化操作失败:', error);
                }
            };

            initializeApp();
        });

        // 定期检查登录状态（可选）
        // setInterval(updateLoginButtonStatus, 60000); // 每分钟检查一次

        // 优化事件监听器的清理
        window.addEventListener('unload', () => {
            // 清理所有超时和未完成的请求
            const cleanup = () => {
                // 这里可以添加任何需要的清理代码
            };
            
            try {
                cleanup();
            } catch (error) {
                console.warn('清理操作失败:', error);
            }
        });

        // 移动端菜单控制
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.querySelector('.menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    navLinks.classList.toggle('active');
                });

                // 点击导航链接后自动关闭菜单
                document.querySelectorAll('.nav-links a').forEach(link => {
                    link.addEventListener('click', () => {
                        menuToggle.classList.remove('active');
                        navLinks.classList.remove('active');
                    });
                });

                // 点击页面其他区域关闭菜单
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.nav-links') && !e.target.closest('.menu-toggle')) {
                        menuToggle.classList.remove('active');
                        navLinks.classList.remove('active');
                    }
                });
            }
        });

        // 在 script 标签内添加以下代码
        // 处理房源筛选标签
        document.addEventListener('DOMContentLoaded', function() {
            const filterTags = document.querySelectorAll('.filter-tag');
            filterTags.forEach(tag => {
                tag.addEventListener('click', () => {
                    // 移除其他标签的active类
                    filterTags.forEach(t => t.classList.remove('active'));
                    // 添加当前标签的active类
                    tag.classList.add('active');
                    // TODO: 根据标签筛选房源
                    filterHouses(tag.textContent);
                });
            });
        });

        // 处理订阅按钮
        document.querySelector('.subscribe-btn').addEventListener('click', async function() {
            const token = localStorage.getItem('token');
            if (!token) {
                // 未登录时跳转到登录页面
                window.location.href = 'login.html';
                return;
            }

            try {
                const baseUrl = getApiBaseUrl();
                const response = await fetch(`${baseUrl}/api/subscribe-houses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        filters: {
                            area: getActiveFilter(),
                            // 可以添加更多筛选条件
                        }
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert('订阅成功！我们会在有新房源时通知您。');
                } else {
                    throw new Error('订阅失败');
                }
            } catch (error) {
                console.error('订阅出错:', error);
                alert('订阅失败，请稍后重试');
            }
        });

        // 处理收藏按钮
        document.querySelectorAll('.favorite-btn').forEach(btn => {
            btn.addEventListener('click', async function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = 'login.html';
                    return;
                }

                const houseCard = this.closest('.house-card');
                const houseId = houseCard.dataset.houseId;

                try {
                    const baseUrl = getApiBaseUrl();
                    const response = await fetch(`${baseUrl}/api/toggle-favorite`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ houseId })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        // 更新收藏按钮状态
                        this.classList.toggle('active');
                        this.textContent = this.classList.contains('active') ? '❤️' : '🤍';
                    }
                } catch (error) {
                    console.error('收藏操作失败:', error);
                    alert('操作失败，请稍后重试');
                }
            });
        });

        // 获取当前激活的筛选标签
        function getActiveFilter() {
            const activeTag = document.querySelector('.filter-tag.active');
            return activeTag ? activeTag.textContent : '全部';
        }

        // 根据筛选条件过滤房源
        async function filterHouses(filter) {
            try {
                const baseUrl = getApiBaseUrl();
                const response = await fetch(`${baseUrl}/api/houses?filter=${encodeURIComponent(filter)}`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    const houses = await response.json();
                    updateHousesGrid(houses);
                }
            } catch (error) {
                console.error('获取房源数据失败:', error);
            }
        }

        // 更新房源展示网格
        function updateHousesGrid(houses) {
            const grid = document.querySelector('.houses-grid');
            grid.innerHTML = houses.map(house => `
                <div class="house-card" data-house-id="${house.id}">
                    <div class="house-header">
                        <h3 class="house-title">${house.title}</h3>
                        ${house.isNew ? '<span class="house-tag new">新上线</span>' : ''}
                    </div>
                    <div class="house-meta">
                        <span class="price">$${house.price}/周</span>
                        <span class="location">${house.location}</span>
                    </div>
                    <div class="house-features">
                        ${house.tags.map(tag => `<span class="feature">${tag}</span>`).join('')}
                    </div>
                    <button class="favorite-btn">${house.isFavorited ? '❤️' : '🤍'}</button>
                    <div class="card-overlay">
                        <div class="view-details">
                            点击查看详情 →
                        </div>
                    </div>
                </div>
            `).join('');

            // 重新绑定收藏按钮事件
            attachFavoriteListeners();
            
            // 绑定房源卡片点击事件
            attachHouseCardListeners();
        }

        // 绑定收藏按钮事件
        function attachFavoriteListeners() {
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const token = localStorage.getItem('token');
                    if (!token) {
                        window.location.href = 'login.html';
                        return;
                    }

                    const houseCard = this.closest('.house-card');
                    const houseId = houseCard.dataset.houseId;

                    try {
                        const baseUrl = getApiBaseUrl();
                        const response = await fetch(`${baseUrl}/api/toggle-favorite`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({ houseId })
                        });

                        if (response.ok) {
                            this.classList.toggle('active');
                            this.textContent = this.classList.contains('active') ? '❤️' : '🤍';
                        }
                    } catch (error) {
                        console.error('收藏操作失败:', error);
                        alert('操作失败，请稍后重试');
                    }
                });
            });
        }

        // 绑定房源卡片点击事件
        function attachHouseCardListeners() {
            document.querySelectorAll('.house-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    // 如果点击的是收藏按钮，不进行跳转
                    if (e.target.closest('.favorite-btn')) {
                        return;
                    }
                    const houseId = this.dataset.houseId;
                    window.location.href = `house-detail.html?id=${houseId}`;
                });
            });
        }

        // 初始化时绑定事件
        document.addEventListener('DOMContentLoaded', () => {
            filterHouses('全部');
            attachHouseCardListeners();
        });

        // 悬浮窗控制代码
        document.addEventListener('DOMContentLoaded', function() {
            const floatingWidget = document.getElementById('floatingWidget');
            const widgetToggle = document.getElementById('widgetToggle');
            const widgetTabs = document.querySelectorAll('.widget-tab');
            const widgetPanels = document.querySelectorAll('.widget-panel');
            const chatInput = document.getElementById('chatInput');
            const chatMessages = document.getElementById('chatMessages');

            // 展开/收起悬浮窗
            widgetToggle.addEventListener('click', function(e) {
                e.stopPropagation(); // 阻止事件冒泡
                floatingWidget.classList.toggle('expanded');
                this.textContent = floatingWidget.classList.contains('expanded') ? '✕' : '🤖';
            });

            // 切换面板
            widgetTabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.stopPropagation(); // 阻止事件冒泡
                    // 移除所有标签的active类
                    widgetTabs.forEach(t => t.classList.remove('active'));
                    // 添加当前标签的active类
                    this.classList.add('active');

                    // 获取目标面板
                    const targetPanel = this.getAttribute('data-panel');
                    
                    // 隐藏所有面板
                    widgetPanels.forEach(panel => panel.classList.remove('active'));
                    // 显示目标面板
                    document.getElementById(targetPanel + 'Panel').classList.add('active');
                });
            });

            // 阻止悬浮窗内部点击事件冒泡
            floatingWidget.addEventListener('click', function(e) {
                e.stopPropagation();
            });

            // 点击悬浮窗外部关闭
            document.addEventListener('click', function(e) {
                if (!floatingWidget.contains(e.target)) {
                    floatingWidget.classList.remove('expanded');
                    widgetToggle.textContent = '🤖';
                }
            });

            // 处理聊天输入
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // 初始化悬浮窗图标
            widgetToggle.textContent = '🤖';
        });

        // 发送消息函数
        function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatMessages = document.getElementById('chatMessages');
            const message = chatInput.value.trim();
            
            if (!message) return;
            
            // 添加用户消息
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.textContent = message;
            chatMessages.appendChild(userMessage);
            
            // 清空输入框
            chatInput.value = '';
            
            // 添加等待消息
            const waitingMessage = document.createElement('div');
            waitingMessage.className = 'message ai';
            waitingMessage.textContent = '正在思考...';
            chatMessages.appendChild(waitingMessage);
            
            // 滚动到底部
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // TODO: 调用AI API处理消息
            // 这里可以添加实际的API调用逻辑
            setTimeout(() => {
                // 移除等待消息
                chatMessages.removeChild(waitingMessage);
                
                // 添加AI回复
                const aiMessage = document.createElement('div');
                aiMessage.className = 'message ai';
                aiMessage.textContent = '您好！我是租房助手，很高兴为您服务。请问有什么可以帮您的吗？';
                chatMessages.appendChild(aiMessage);
                
                // 滚动到底部
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        }

        // 原有的JavaScript代码
        // ... existing code ...
    </script>
</body>
</html> 